<!DOCTYPE html>
<html>
<head>
    <title>YouTube OAuth Callback</title>
    <meta charset="utf-8">
    <style>
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0; 
            background: #f5f5f5; 
        }
        .container { 
            text-align: center; 
            background: white; 
            padding: 2rem; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .success { color: #16a34a; }
        .error { color: #dc2626; }
    </style>
</head>
<body>
    <div class="container">
        <div id="status">ì²˜ë¦¬ ì¤‘...</div>
    </div>

    <script>
        function handleCallback() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                const error = urlParams.get('error');
                const errorDescription = urlParams.get('error_description');
                const statusEl = document.getElementById('status');

                console.log('ğŸ”„ [OAuth Callback] í˜ì´ì§€ ë¡œë“œë¨');
                console.log('ğŸ”„ [OAuth Callback] URL:', window.location.href);
                console.log('ğŸ”„ [OAuth Callback] íŒŒë¼ë¯¸í„°:', { code: !!code, error, errorDescription });

                if (error) {
                    let errorMsg = error;
                    if (error === 'access_denied') {
                        errorMsg = 'ì‚¬ìš©ìê°€ ì¸ì¦ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤';
                    } else if (errorDescription) {
                        errorMsg = errorDescription;
                    }
                    
                    statusEl.innerHTML = `<div class="error">âŒ ì¸ì¦ ì‹¤íŒ¨<br><small>${errorMsg}</small></div>`;
                    
                    // ë¶€ëª¨ ì°½ì— ì˜¤ë¥˜ ì „ì†¡
                    console.log('âŒ [OAuth Callback] ì˜¤ë¥˜ ë°œìƒ:', errorMsg);
                    if (window.opener && !window.opener.closed) {
                        try {
                            console.log('ğŸ“¤ [OAuth Callback] ë¶€ëª¨ ì°½ì— ì˜¤ë¥˜ ì „ì†¡ ì¤‘...');
                            window.opener.postMessage({
                                type: 'OAUTH_ERROR',
                                error: errorMsg
                            }, window.location.origin);
                            console.log('âœ… [OAuth Callback] ì˜¤ë¥˜ ì „ì†¡ ì™„ë£Œ');
                        } catch (postError) {
                            console.error('âŒ [OAuth Callback] ë¶€ëª¨ì°½ ì˜¤ë¥˜ ì „ì†¡ ì‹¤íŒ¨:', postError);
                        }
                    } else {
                        console.error('âŒ [OAuth Callback] ë¶€ëª¨ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    }
                    
                    setTimeout(() => {
                        try { window.close(); } catch (e) { console.warn('Could not close window:', e); }
                    }, 3000);
                    return;
                }

                if (code && code.length > 0) {
                    statusEl.innerHTML = `<div class="success">âœ… ì¸ì¦ ì™„ë£Œ<br><small>ì°½ì´ ìë™ìœ¼ë¡œ ë‹«í™ë‹ˆë‹¤...</small></div>`;
                    
                    // ë¶€ëª¨ ì°½ì— ì½”ë“œ ì „ì†¡
                    console.log('âœ… [OAuth Callback] ì¸ì¦ ì½”ë“œ ë°›ìŒ:', code.substring(0, 20) + '...');
                    if (window.opener && !window.opener.closed) {
                        try {
                            console.log('ğŸ“¤ [OAuth Callback] ë¶€ëª¨ ì°½ì— ì½”ë“œ ì „ì†¡ ì¤‘...');
                            window.opener.postMessage({
                                type: 'OAUTH_SUCCESS',
                                code: code
                            }, window.location.origin);
                            console.log('ğŸ‰ [OAuth Callback] ì½”ë“œ ì „ì†¡ ì™„ë£Œ!');
                        } catch (postError) {
                            console.error('âŒ [OAuth Callback] ë¶€ëª¨ì°½ ì½”ë“œ ì „ì†¡ ì‹¤íŒ¨:', postError);
                            statusEl.innerHTML = `<div class="error">âŒ ë¶€ëª¨ ì°½ê³¼ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>`;
                        }
                    } else {
                        console.error('âŒ [OAuth Callback] ë¶€ëª¨ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                        statusEl.innerHTML = `<div class="error">âŒ ë¶€ëª¨ ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>`;
                    }
                    
                    setTimeout(() => {
                        try { window.close(); } catch (e) { console.warn('Could not close window:', e); }
                    }, 1500);
                } else {
                    statusEl.innerHTML = `<div class="error">âŒ ì¸ì¦ ì½”ë“œë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤<br><small>URLì—ì„œ ì½”ë“œ íŒŒë¼ë¯¸í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</small></div>`;
                    setTimeout(() => {
                        try { window.close(); } catch (e) { console.warn('Could not close window:', e); }
                    }, 3000);
                }
            } catch (err) {
                console.error('Callback error:', err);
                const statusEl = document.getElementById('status');
                if (statusEl) {
                    statusEl.innerHTML = `<div class="error">âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤<br><small>${err.message}</small></div>`;
                }
                setTimeout(() => {
                    try { window.close(); } catch (e) { console.warn('Could not close window:', e); }
                }, 3000);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì½œë°± ì²˜ë¦¬
        window.addEventListener('load', handleCallback);
    </script>
</body>
</html>